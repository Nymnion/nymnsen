<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nymnsen's Trinkets & Curiosities</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4e2a84; /* Deep purple */
            --primary-color-rgb: 78, 42, 132;
            --secondary-color: #8661c5; /* Lighter purple */
            --accent-color: #00b4cc; /* Teal */
            --accent-color-rgb: 0, 180, 204;
            --danger-color: #c41e3a; /* Crimson */
            --background-dark: #121212;
            --background-medium: #1e1e1e;
            --background-light: #2d2d2d;
            --text-color: #e0e0e0;
            --border-color: #383838;
            
            /* Item quality colors */
            --common-color: #9d9d9d;
            --uncommon-color: #1eff00;
            --rare-color: #0070dd;
            --epic-color: #a335ee;
            --legendary-color: #ff8000;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Open Sans', sans-serif;
        }

        body {
            background-color: var(--background-dark);
            color: var(--text-color);
            line-height: 1.6;
            background-image: url('https://bnetcmsus-a.akamaihd.net/cms/template_resource/OZSIXGJY1GNT1648559424562.jpg');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            background-blend-mode: overlay;
        }

        .overlay {
            background-color: rgba(18, 18, 18, 0.9);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 20px 0;
            position: relative;
        }

        .shop-title {
            font-family: 'Cinzel', serif;
            color: #fff;
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 0 10px var(--accent-color), 0 0 20px var(--accent-color), 0 0 30px var(--primary-color);
            font-weight: 700;
            letter-spacing: 1px;
            position: relative;
            display: inline-block;
        }
        
        .shop-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            width: 60%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
            transform: translateX(-50%);
        }

        .shop-subtitle {
            color: var(--accent-color);
            font-size: 1.2rem;
            margin-bottom: 20px;
            opacity: 0.9;
            font-weight: 300;
            letter-spacing: 1px;
        }

        /* Category Navigation */
        .categories {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            position: relative;
            background-color: rgba(30, 30, 30, 0.7);
            border-radius: 8px;
            padding: 3px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), inset 0 1px 1px rgba(255, 255, 255, 0.1);
        }

        .category-tab {
            background: rgba(40, 40, 50, 0.7);
            color: var(--text-color);
            padding: 14px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            flex: 1;
            text-align: center;
            font-weight: 600;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
            position: relative;
            backdrop-filter: blur(4px);
            z-index: 1;
            margin: 0 2px;
            text-transform: uppercase;
            border-radius: 5px;
        }

        .category-tab:first-child {
            margin-left: 0;
        }

        .category-tab:last-child {
            margin-right: 0;
        }

        .category-tab:hover {
            background: rgba(var(--primary-color-rgb), 0.4);
            color: #fff;
            box-shadow: inset 0 0 5px rgba(var(--accent-color-rgb), 0.3);
        }

        .category-tab.active {
            background: rgba(var(--accent-color-rgb), 0.3);
            color: #fff;
            box-shadow: inset 0 0 8px rgba(var(--accent-color-rgb), 0.5);
        }

        .category-tab.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
            opacity: 0.8;
        }

        /* Main Content Layout */
        .content {
            display: flex;
            gap: 30px;
        }

        .items-container {
            flex: 1;
        }

        /* Item Listings */
        .item-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .item-card {
            background: linear-gradient(135deg, rgba(30, 30, 30, 0.9) 0%, rgba(18, 18, 18, 0.95) 100%);
            border-radius: 5px;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(60, 60, 60, 0.3);
            backdrop-filter: blur(4px);
        }

        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5), 0 0 15px rgba(var(--accent-color-rgb), 0.3);
            border-color: rgba(var(--accent-color-rgb), 0.3);
        }

        .item-header {
            padding: 10px;
            position: relative;
            border-radius: 5px 5px 0 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .item-icon {
            width: 36px;
            height: 36px;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .item-name {
            flex: 1;
            font-weight: 600;
            font-size: 1rem;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
            text-decoration: underline; /* Simple underline to indicate it's clickable */
            text-underline-offset: 2px; /* Space between text and underline */
            text-decoration-color: rgba(255, 255, 255, 0.4); /* Subtle underline color */
        }

        .item-name:hover {
            text-decoration-color: var(--accent-color); /* Highlight on hover */
        }

        .item-details {
            padding: 8px 10px; /* Reduced padding */
            background-color: rgba(0, 0, 0, 0.2);
            border-top: 1px solid var(--border-color);
        }

        .item-price {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        /* Improve gold/silver icon spacing and styling */
        .gold-icon, .silver-icon {
            width: 15px;
            height: 15px;
            display: inline-block;
            margin: 0 2px;
            border-radius: 50%;
            vertical-align: middle;
        }

        .gold-icon {
            background-color: #ffd700;
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.7);
        }

        .silver-icon {
            background-color: #c0c0c0;
            box-shadow: 0 0 5px rgba(192, 192, 192, 0.7);
        }

        .item-stock {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .item-actions {
            padding: 8px 10px; /* Reduced padding */
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid var(--border-color);
        }

        .quantity-controls {
            display: flex;
            align-items: center;
        }

        .quantity-btn {
            width: 28px;
            height: 28px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: rgba(45, 45, 45, 0.6);
            color: var(--text-color);
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
            box-shadow: inset 0 1px rgba(255, 255, 255, 0.05);
        }

        .quantity-btn:hover {
            background-color: rgba(78, 42, 132, 0.5);
            border-color: rgba(78, 42, 132, 0.8);
            color: white;
        }

        .quantity-input {
            width: 40px;
            height: 30px;
            text-align: center;
            border: none;
            background-color: var(--background-light);
            color: var(--text-color);
            font-size: 0.9rem;
            margin: 0 5px;
            border-radius: 4px;
        }

        .add-to-cart {
            background-color: rgba(0, 180, 204, 0.2);
            color: white;
            border: 1px solid rgba(0, 180, 204, 0.5);
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3), inset 0 1px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(4px);
        }

        .add-to-cart:hover {
            background-color: rgba(0, 180, 204, 0.4);
            border-color: rgba(0, 180, 204, 0.8);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4), 0 0 10px rgba(0, 180, 204, 0.3), inset 0 1px rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        
        .add-to-cart:active {
            transform: translateY(1px);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.4), inset 0 1px rgba(255, 255, 255, 0.1);
        }

        /* Quality-specific styling */
        .common .item-header {
            background: linear-gradient(135deg, rgba(45, 45, 45, 0.8) 0%, rgba(26, 26, 26, 0.8) 100%);
            border-bottom: 2px solid var(--common-color);
            box-shadow: inset 0 0 10px rgba(157, 157, 157, 0.1);
        }

        .uncommon .item-header {
            background: linear-gradient(135deg, rgba(20, 40, 20, 0.8) 0%, rgba(10, 30, 10, 0.8) 100%);
            border-bottom: 2px solid var(--uncommon-color);
            box-shadow: inset 0 0 15px rgba(30, 255, 0, 0.1);
        }

        .uncommon .item-name {
            color: var(--uncommon-color);
            text-shadow: 0 0 5px rgba(30, 255, 0, 0.3);
        }

        .rare .item-header {
            background: linear-gradient(135deg, rgba(16, 42, 73, 0.8) 0%, rgba(6, 20, 37, 0.8) 100%);
            border-bottom: 2px solid var(--rare-color);
            box-shadow: inset 0 0 15px rgba(0, 112, 221, 0.2);
        }

        .rare .item-name {
            color: var(--rare-color);
            text-shadow: 0 0 5px rgba(0, 112, 221, 0.3);
        }

        .epic .item-header {
            background: linear-gradient(135deg, rgba(59, 19, 86, 0.8) 0%, rgba(26, 10, 41, 0.8) 100%);
            border-bottom: 2px solid var(--epic-color);
            box-shadow: inset 0 0 15px rgba(163, 53, 238, 0.2);
        }

        .epic .item-name {
            color: var(--epic-color);
            text-shadow: 0 0 5px rgba(163, 53, 238, 0.3);
        }

        .legendary .item-header {
            background: linear-gradient(135deg, rgba(86, 43, 6, 0.8) 0%, rgba(45, 22, 3, 0.8) 100%);
            border-bottom: 2px solid var(--legendary-color);
            box-shadow: inset 0 0 15px rgba(255, 128, 0, 0.2);
        }

        .legendary .item-name {
            color: var(--legendary-color);
            text-shadow: 0 0 5px rgba(255, 128, 0, 0.3);
        }

        /* Add rarity-based glow effects */
        .common:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5), 0 0 15px rgba(255, 255, 255, 0.3);
        }

        .uncommon:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5), 0 0 15px rgba(30, 255, 0, 0.3);
        }

        .rare:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5), 0 0 15px rgba(0, 112, 221, 0.3);
        }

        .epic:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5), 0 0 15px rgba(163, 53, 238, 0.3);
        }

        .legendary:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5), 0 0 15px rgba(255, 128, 0, 0.3);
        }

        /* Shopping Basket */
        .shopping-basket {
            width: 300px;
            background: linear-gradient(135deg, rgba(30, 30, 30, 0.9) 0%, rgba(18, 18, 18, 0.95) 100%);
            border-radius: 5px;
            padding: 15px;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }

        .basket-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 15px;
        }

        .basket-title {
            font-family: 'Open Sans', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent-color);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .basket-count {
            background-color: var(--accent-color);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .basket-items {
            margin-bottom: 15px;
            max-height: 350px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        /* Custom scrollbar for the basket */
        .basket-items::-webkit-scrollbar {
            width: 6px;
        }
        
        .basket-items::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .basket-items::-webkit-scrollbar-thumb {
            background: rgba(var(--accent-color-rgb), 0.3);
            border-radius: 10px;
        }
        
        .basket-items::-webkit-scrollbar-thumb:hover {
            background: rgba(var(--accent-color-rgb), 0.5);
        }

        /* Basket item styling improvements */
        .basket-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 10px;
            margin-bottom: 10px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .basket-item-info {
            flex: 1;
            min-width: 0; /* Prevent flex items from overflowing */
        }

        .basket-item-details {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .basket-item-name {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.95rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .basket-item-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .basket-quantity-controls {
            display: flex;
            align-items: center;
        }

        .basket-quantity-btn {
            width: 24px;
            height: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: rgba(45, 45, 45, 0.6);
            color: var(--text-color);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .basket-quantity-input {
            width: 30px;
            height: 24px;
            text-align: center;
            background-color: rgba(30, 30, 30, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            font-size: 0.9rem;
            margin: 0 2px;
        }

        .basket-item-total {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            gap: 2px; /* Add consistent spacing between elements */
        }

        .basket-item-total span {
            margin: 0 1px; /* Add small margin for better readability */
        }

        .basket-item-remove {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0 5px;
            transition: all 0.2s ease;
            position: absolute;
            top: 5px;
            right: 5px;
        }

        .basket-item-remove:hover {
            color: var(--danger-color);
        }

        .basket-summary {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .summary-row:last-child {
            margin-bottom: 0;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
            font-weight: bold;
        }

        .checkout-btn {
            width: 100%;
            background-color: rgba(0, 180, 204, 0.2);
            color: white;
            border: 1px solid rgba(0, 180, 204, 0.6);
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            letter-spacing: 0.8px;
            text-transform: uppercase;
            transition: all 0.2s ease;
            margin-top: 15px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3), inset 0 1px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(4px);
        }

        .checkout-btn:hover {
            background-color: rgba(0, 180, 204, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4), 0 0 15px rgba(0, 180, 204, 0.3);
            border-color: rgba(0, 180, 204, 0.8);
        }
        
        .checkout-btn:active {
            transform: translateY(1px);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
        }

        .empty-basket-message {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: rgba(255, 255, 255, 0.5);
        }

        /* Modal for checkout */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(18, 18, 18, 0.98) 100%);
            border-radius: 8px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.7), 0 0 15px rgba(var(--accent-color-rgb), 0.2);
            border: 1px solid var(--border-color);
            position: relative;
        }

        .modal-content h2 {
            color: var(--accent-color);
            margin-bottom: 15px;
            font-size: 1.5rem;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(var(--accent-color-rgb), 0.3);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.2s ease;
        }

        .close-modal:hover {
            color: var(--danger-color);
        }

        .checkout-info {
            margin-bottom: 15px;
        }

        .in-game-mail {
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            color: #ccc;
            max-height: 200px;
            overflow-y: auto;
            line-height: 1.4;
        }

        .copy-mail-btn {
            background-color: rgba(0, 180, 204, 0.2);
            color: white;
            border: 1px solid rgba(0, 180, 204, 0.6);
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            letter-spacing: 0.8px;
            text-transform: uppercase;
            transition: all 0.2s ease;
            display: block;
            margin: 0 auto 20px auto;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3), inset 0 1px rgba(255, 255, 255, 0.1);
            width: 80%;
        }

        .copy-mail-btn:hover {
            background-color: rgba(0, 180, 204, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4), 0 0 15px rgba(0, 180, 204, 0.3);
            border-color: rgba(0, 180, 204, 0.8);
        }

        .copy-mail-btn:active {
            transform: translateY(1px);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
        }

        .copy-success {
            text-align: center;
            color: var(--accent-color);
            margin-bottom: 15px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .copy-success.show {
            opacity: 1;
        }

        .checkout-instructions {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            padding: 15px;
            border: 1px solid var(--border-color);
            margin-top: 5px;
            line-height: 1.5;
        }

        .checkout-instructions p {
            margin-bottom: 8px;
        }

        .checkout-instructions p:last-child {
            margin-bottom: 0;
        }

        /* Loader */
        .loader {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(78, 42, 132, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive adjustments */
        @media (max-width: 900px) {
            .content {
                flex-direction: column;
            }

            .shopping-basket {
                width: 100%;
                position: static;
                margin-top: 30px;
            }

            .categories {
                flex-wrap: wrap;
            }

            .category-tab {
                padding: 10px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 600px) {
            .item-list {
                grid-template-columns: 1fr;
            }
        }

        /* Additional glossy effects for item cards */
        .item-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.2), transparent);
        }

        /* Wowhead tooltip styles */
        .wowhead-tooltip {
            z-index: 1000 !important;
        }
        
        /* Fix for sticky tooltips */
        #wowhead-tooltip {
            z-index: 100000 !important;
            pointer-events: none !important; /* Prevent tooltip from capturing hover */
            position: absolute !important;
        }
        
        /* Ensure all elements with data-wowhead attribute are clickable */
        [data-wowhead] {
            cursor: pointer;
            position: relative;
        }
        
        /* Add subtle highlight effect to wowhead elements */
        [data-wowhead]:hover {
            text-shadow: 0 0 2px var(--accent-color);
        }
        
        /* Fix tooltip popup positioning */
        #wowhead-tooltip {
            z-index: 10000 !important;
        }

        /* Ensure Wowhead links don't have underlines or color changes */
        a.wowhead-link {
            text-decoration: none !important;
            color: inherit !important;
            cursor: pointer;
        }

        /* But the parent element (item-name) should have the underline */
        .item-name {
            text-decoration: underline;
            text-underline-offset: 2px;
            text-decoration-color: rgba(255, 255, 255, 0.4);
        }

        .item-name:hover {
            text-decoration-color: var(--accent-color);
        }

        /* Add this right after the category tabs */
        .sorting-controls {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            border: 1px solid var(--border-color);
        }

        .sorting-controls label {
            margin-right: 10px;
            font-weight: 600;
            color: var(--accent-color);
        }

        .sort-select {
            background-color: rgba(30, 30, 30, 0.8);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .sort-select:hover {
            border-color: var(--accent-color);
        }

        .sort-select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(var(--accent-color-rgb), 0.2);
        }

        /* Apply rarity colors to basket items */
        .basket-item-name a.wowhead-link {
            text-decoration: none !important;
            color: inherit !important;
        }

        .basket-item-name.common a.wowhead-link {
            color: var(--common-color) !important;
        }

        .basket-item-name.uncommon a.wowhead-link {
            color: var(--uncommon-color) !important;
            text-shadow: 0 0 3px rgba(30, 255, 0, 0.3);
        }

        .basket-item-name.rare a.wowhead-link {
            color: var(--rare-color) !important;
            text-shadow: 0 0 3px rgba(0, 112, 221, 0.3);
        }

        .basket-item-name.epic a.wowhead-link {
            color: var(--epic-color) !important;
            text-shadow: 0 0 3px rgba(163, 53, 238, 0.3);
        }

        .basket-item-name.legendary a.wowhead-link {
            color: var(--legendary-color) !important;
            text-shadow: 0 0 3px rgba(255, 128, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="overlay">
        <div class="container">
            <header>
                <h1 class="shop-title">Nymnsen's Trinkets & Curiosities</h1>
                <p class="shop-subtitle">Presented with love (& greed) for all of OnlyFangs!</p>
            </header>

            <div class="categories">
                <button class="category-tab active" data-category="all">All Items</button>
                <button class="category-tab" data-category="consumables">Consumables</button>
                <button class="category-tab" data-category="herbs">Herbs</button>
                <button class="category-tab" data-category="reagents">Reagents</button>
                <button class="category-tab" data-category="items">Equipment</button>
                <button class="category-tab" data-category="patterns">Patterns</button>
                <button class="category-tab" data-category="cloth">Cloth</button>
                <button class="category-tab" data-category="other">Other</button>
            </div>

            <!-- Add this right after the category tabs -->
            <div class="sorting-controls">
                <label for="sortSelect">Sort by:</label>
                <select id="sortSelect" class="sort-select">
                    <option value="rarity-desc">Rarity (Highest first)</option>
                    <option value="rarity-asc">Rarity (Lowest first)</option>
                    <option value="price-desc">Price (Highest first)</option>
                    <option value="price-asc">Price (Lowest first)</option>
                    <option value="name-asc">Name (A-Z)</option>
                    <option value="name-desc">Name (Z-A)</option>
                </select>
            </div>

            <div class="content">
                <div class="items-container">
                    <div class="item-list" id="itemList">
                        <!-- Items will be loaded here -->
                        <div class="loader">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>

                <div class="shopping-basket" id="basket">
                    <div class="basket-header">
                        <h2 class="basket-title">Shopping Basket</h2>
                        <div class="basket-count" id="basketCount">0</div>
                    </div>
                    
                    <div class="basket-items" id="basketItems">
                        <div class="empty-basket-message">Your basket is empty</div>
                    </div>
                    
                    <div class="basket-summary">
                        <div class="summary-row">
                            <span>Items:</span>
                            <span id="basketItemsCount">0</span>
                        </div>
                        <div class="summary-row">
                            <span>Total:</span>
                            <span id="basketTotal">
                                <span id="basketGold">0</span>
                                <span class="gold-icon"></span>
                                <span id="basketSilver">0</span>
                                <span class="silver-icon"></span>
                            </span>
                        </div>
                    </div>
                    
                    <button class="checkout-btn" id="checkoutBtn">Checkout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Replace the existing modal-overlay with this improved version -->
    <div class="modal-overlay" id="checkoutModal">
        <div class="modal-content">
            <span class="close-modal" id="closeModal">&times;</span>
            <h2>Your Order</h2>
            
            <div class="in-game-mail" id="mailText"></div>
            <button class="copy-mail-btn" id="copyMailBtn">COPY TO CLIPBOARD</button>
            <p class="copy-success" id="copySuccess">Copied successfully!</p>
            
            <div class="checkout-instructions">
                <p><strong>Instructions:</strong></p>
                <p>Copy the text above and send it to <strong>Nymnsen</strong> via in-game mail. The items will be sent to you via C.O.D. (Cash on Delivery).</p>
            </div>
        </div>
    </div>

    <!-- Include the inventory data -->
    <script src="inventory.js?v=20250226-3"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elements
            const itemList = document.getElementById('itemList');
            const basketItems = document.getElementById('basketItems');
            const basketCount = document.getElementById('basketCount');
            const basketItemsCount = document.getElementById('basketItemsCount');
            const basketGold = document.getElementById('basketGold');
            const basketSilver = document.getElementById('basketSilver');
            const checkoutBtn = document.getElementById('checkoutBtn');
            const checkoutModal = document.getElementById('checkoutModal');
            const closeModal = document.getElementById('closeModal');
            const mailText = document.getElementById('mailText');
            const copyMailBtn = document.getElementById('copyMailBtn');
            const copySuccess = document.getElementById('copySuccess');
            const categoryTabs = document.querySelectorAll('.category-tab');
            
            // Add RGB versions of colors for use in rgba()
            document.documentElement.style.setProperty('--primary-color-rgb', '78, 42, 132');
            document.documentElement.style.setProperty('--accent-color-rgb', '0, 180, 204');
            
            // Shopping cart array to store selected items
            let cart = [];
            let currentCategory = 'all';
            
            // Display items based on the current category
            function displayItems(category, sortBy = 'rarity-desc') {
                // Clear the item list
                itemList.innerHTML = '';
                
                // Show all items or filter by category
                let items = [];
                if (category === 'all') {
                    shopInventory.categories.forEach(cat => {
                        items = items.concat(cat.items.map(item => ({...item, category: cat.id})));
                    });
                } else {
                    const categoryData = shopInventory.categories.find(cat => cat.id === category);
                    if (categoryData) {
                        items = categoryData.items.map(item => ({...item, category: category}));
                    }
                }
                
                // Sort items based on sortBy parameter
                items = sortItems(items, sortBy);
                
                // Create item cards
                items.forEach(item => {
                    const itemCard = document.createElement('div');
                    itemCard.className = `item-card ${item.quality}`;
                    itemCard.innerHTML = `
                        <div class="item-header">
                            <div class="item-name">
                                <a href="https://www.wowhead.com/classic/item=${item.id}" 
                                   data-wowhead="item=${item.id}&domain=classic" 
                                   class="wowhead-link" 
                                   target="_blank">${item.name}</a>
                            </div>
                        </div>
                        <div class="item-details">
                            <div class="item-price">
                                ${createPriceHTML(item)}
                            </div>
                            <div class="item-stock">In stock: ${item.stock}</div>
                            ${item.unique ? '<div style="color: #ff8c00; font-size: 0.8rem;">Unique Item</div>' : ''}
                        </div>
                        <div class="item-actions">
                            <div class="quantity-controls">
                                <button class="quantity-btn qty-minus" data-id="${item.id}">-</button>
                                <input type="number" class="quantity-input" min="1" max="${item.stock}" value="1" data-id="${item.id}">
                                <button class="quantity-btn qty-plus" data-id="${item.id}">+</button>
                            </div>
                            <button class="add-to-cart" data-id="${item.id}" data-category="${item.category}">
                                Add to Cart
                            </button>
                        </div>
                    `;
                    itemList.appendChild(itemCard);
                    
                    // Add event listeners for quantity buttons
                    const minusBtn = itemCard.querySelector('.qty-minus');
                    const plusBtn = itemCard.querySelector('.qty-plus');
                    const qtyInput = itemCard.querySelector('.quantity-input');
                    
                    minusBtn.addEventListener('click', function() {
                        if (parseInt(qtyInput.value) > 1) {
                            qtyInput.value = parseInt(qtyInput.value) - 1;
                        }
                    });
                    
                    plusBtn.addEventListener('click', function() {
                        if (parseInt(qtyInput.value) < parseInt(qtyInput.max)) {
                            qtyInput.value = parseInt(qtyInput.value) + 1;
                        }
                    });
                    
                    // Add event listener for add to cart button
                    const addToCartBtn = itemCard.querySelector('.add-to-cart');
                    addToCartBtn.addEventListener('click', function() {
                        const itemId = this.dataset.id;
                        const itemCategory = this.dataset.category;
                        const quantity = parseInt(qtyInput.value);
                        
                        // Find item in inventory
                        const category = shopInventory.categories.find(cat => cat.id === itemCategory);
                        const item = category.items.find(i => i.id === itemId);
                        
                        // Check if already in cart
                        const existingItem = cart.find(cartItem => cartItem.id === itemId);
                        
                        if (existingItem) {
                            // Check if adding would exceed stock
                            if (existingItem.quantity + quantity <= item.stock) {
                                existingItem.quantity += quantity;
                            } else {
                                existingItem.quantity = item.stock; // Set to max available
                                alert(`You can only add ${item.stock} of this item to your cart.`);
                            }
                        } else {
                            // Add new item to cart
                            cart.push({
                                id: item.id,
                                name: item.name,
                                price: {...item.price},
                                quantity: quantity,
                                category: itemCategory,
                                quality: item.quality,
                                stock: item.stock
                            });
                        }
                        
                        // Update the cart display
                        updateCartDisplay();
                    });
                });
                
                // Refresh Wowhead tooltips
                if (window.$WowheadPower) {
                    window.$WowheadPower.refreshLinks();
                }
            }
            
            // Update the cart display function to use Wowhead's built-in icon functionality
            function updateCartDisplay() {
                // Clear current display
                basketItems.innerHTML = '';
                
                if (cart.length === 0) {
                    basketItems.innerHTML = '<div class="empty-basket-message">Your basket is empty</div>';
                    basketCount.textContent = '0';
                    basketItemsCount.textContent = '0';
                    basketGold.textContent = '0';
                    basketSilver.textContent = '0';
                    return;
                }
                
                // Count total items and cost
                let totalItems = 0;
                let totalGold = 0;
                let totalSilver = 0;
                
                cart.forEach(item => {
                    // Create cart item element
                    const cartItemEl = document.createElement('div');
                    cartItemEl.className = 'basket-item';
                    
                    // Calculate item total
                    const itemTotalSilver = item.price.total * item.quantity;
                    const itemGold = Math.floor(itemTotalSilver / 100);
                    const itemSilver = itemTotalSilver % 100;
                    
                    cartItemEl.innerHTML = `
                        <div class="basket-item-info">
                            <div class="basket-item-details">
                                <div class="basket-item-name ${item.quality}">
                                    <a href="https://www.wowhead.com/classic/item=${item.id}" 
                                       data-wowhead="item=${item.id}&domain=classic" 
                                       class="wowhead-link" 
                                       target="_blank">${item.name}</a>
                                </div>
                                <div class="basket-item-actions">
                                    <div class="basket-quantity-controls">
                                        <button class="basket-quantity-btn basket-qty-minus" data-id="${item.id}">-</button>
                                        <input type="number" class="basket-quantity-input" min="1" max="${item.stock}" value="${item.quantity}" data-id="${item.id}">
                                        <button class="basket-quantity-btn basket-qty-plus" data-id="${item.id}">+</button>
                                    </div>
                                    <div class="basket-item-total" title="Price per item: ${item.price.gold}g ${item.price.silver}s">
                                        <span>${itemGold}</span>
                                        <span class="gold-icon"></span>
                                        <span>${itemSilver}</span>
                                        <span class="silver-icon"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button class="basket-item-remove" data-id="${item.id}" title="Remove item">×</button>
                    `;
                    
                    basketItems.appendChild(cartItemEl);
                    
                    // Add event listeners for cart quantity
                    const minusBtn = cartItemEl.querySelector('.basket-qty-minus');
                    const plusBtn = cartItemEl.querySelector('.basket-qty-plus');
                    const qtyInput = cartItemEl.querySelector('.basket-quantity-input');
                    const removeBtn = cartItemEl.querySelector('.basket-item-remove');
                    
                    minusBtn.addEventListener('click', function() {
                        const itemId = this.dataset.id;
                        const cartItem = cart.find(item => item.id === itemId);
                        
                        if (cartItem.quantity > 1) {
                            cartItem.quantity--;
                            updateCartDisplay();
                        }
                    });
                    
                    plusBtn.addEventListener('click', function() {
                        const itemId = this.dataset.id;
                        const cartItem = cart.find(item => item.id === itemId);
                        
                        if (cartItem.quantity < cartItem.stock) {
                            cartItem.quantity++;
                            updateCartDisplay();
                        }
                    });
                    
                    qtyInput.addEventListener('change', function() {
                        const itemId = this.dataset.id;
                        const cartItem = cart.find(item => item.id === itemId);
                        const newQty = parseInt(this.value);
                        
                        if (newQty > 0 && newQty <= cartItem.stock) {
                            cartItem.quantity = newQty;
                        } else if (newQty > cartItem.stock) {
                            cartItem.quantity = cartItem.stock;
                        } else {
                            cartItem.quantity = 1;
                        }
                        
                        updateCartDisplay();
                    });
                    
                    removeBtn.addEventListener('click', function() {
                        const itemId = this.dataset.id;
                        cart = cart.filter(item => item.id !== itemId);
                        updateCartDisplay();
                    });
                    
                    // Update totals
                    totalItems += item.quantity;
                    totalSilver += itemTotalSilver;
                });
                
                // Update basket counts and totals
                totalGold = Math.floor(totalSilver / 100);
                totalSilver = totalSilver % 100;
                
                basketCount.textContent = totalItems;
                basketItemsCount.textContent = totalItems;
                basketGold.textContent = totalGold;
                basketSilver.textContent = totalSilver;
                
                // Refresh Wowhead tooltips
                if (window.$WowheadPower) {
                    window.$WowheadPower.refreshLinks();
                }
            }
            
            // Generate in-game mail text
            function generateMailText() {
                const date = new Date().toLocaleDateString();
                let text = `ORDER - ${date}\n\n`;
                // Remove the "TO: Nymnsen" line
                // text += `TO: Nymnsen\n\n`;
                
                // Add items
                cart.forEach(item => {
                    const itemTotalSilver = item.price.total * item.quantity;
                    const itemGold = Math.floor(itemTotalSilver / 100);
                    const itemSilver = itemTotalSilver % 100;
                    
                    text += `${item.name} x${item.quantity} (${item.price.gold}g ${item.price.silver}s each) = ${itemGold}g ${itemSilver}s\n`;
                });
                
                // Add total
                let totalSilver = 0;
                cart.forEach(item => {
                    totalSilver += item.price.total * item.quantity;
                });
                
                const totalGold = Math.floor(totalSilver / 100);
                const remainingSilver = totalSilver % 100;
                
                text += `\nTOTAL: ${totalGold} gold and ${remainingSilver} silver`;
                
                return text;
            }
            
            // Initialize the shop
            function init() {
                // Display all items initially with default sorting (rarity-desc)
                displayItems('all', 'rarity-desc');
                
                // Add event listeners for category tabs
                categoryTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        // Update active tab
                        categoryTabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        // Update items display with current sort
                        currentCategory = this.dataset.category;
                        const currentSort = document.getElementById('sortSelect').value;
                        displayItems(currentCategory, currentSort);
                    });
                });
                
                // Add event listener for sort select
                const sortSelect = document.getElementById('sortSelect');
                sortSelect.addEventListener('change', function() {
                    displayItems(currentCategory, this.value);
                });
                
                // Checkout button
                checkoutBtn.addEventListener('click', function() {
                    if (cart.length === 0) {
                        alert('Your basket is empty!');
                        return;
                    }
                    
                    mailText.textContent = generateMailText();
                    checkoutModal.classList.add('active');
                });
                
                // Close modal
                closeModal.addEventListener('click', function() {
                    checkoutModal.classList.remove('active');
                });
                
                // Copy mail text
                copyMailBtn.addEventListener('click', function() {
                    const tempTextarea = document.createElement('textarea');
                    tempTextarea.value = mailText.textContent;
                    document.body.appendChild(tempTextarea);
                    tempTextarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempTextarea);
                    
                    copySuccess.classList.add('show');
                    setTimeout(() => {
                        copySuccess.classList.remove('show');
                    }, 2000);
                });
                
                // Close modal when clicking outside
                checkoutModal.addEventListener('click', function(e) {
                    if (e.target === checkoutModal) {
                        checkoutModal.classList.remove('active');
                    }
                });
            }
            
            // Initialize the shop
            init();
        });
    </script>

    <!-- Add this script right after the main shop script, before the Wowhead scripts -->
    <script>
        // Define a global function to update item icons
        function updateClassicItemIcons() {
            // Process all elements with data-item-id attribute
            document.querySelectorAll('[data-item-id]').forEach(element => {
                const itemId = element.getAttribute('data-item-id');
                
                // Map for Classic WoW item icons
                const classicIconMap = {
                    '16971': 'inv_misc_fish_13', // Clamlette Surprise
                    '3825': 'inv_potion_44',    // Elixir of Fortitude
                    '9187': 'inv_potion_09',    // Elixir of Greater Agility
                    '9264': 'inv_potion_27',    // Elixir of Shadow Power
                    '5634': 'inv_potion_04',    // Free Action Potion
                    '13454': 'inv_potion_82',   // Greater Arcane Elixir
                    '13461': 'inv_potion_45',   // Greater Arcane Protection Potion
                    '13457': 'inv_potion_22',   // Greater Fire Protection Potion
                    '1710': 'inv_potion_53',    // Greater Healing Potion
                    '3823': 'inv_potion_47',    // Lesser Invisibility Potion
                    '3387': 'inv_potion_83',    // Limited Invulnerability Potion
                    '13446': 'inv_potion_76',   // Major Healing Potion
                    '3826': 'inv_potion_07',    // Mighty Troll's Blood Potion
                    '118': 'inv_potion_51',     // Minor Healing Potion
                    '8766': 'inv_drink_10',     // Morning Glory Dew
                    '13931': 'inv_drink_milk_05', // Nightfin Soup
                    '8956': 'inv_potion_25',    // Oil of Immolation
                    '5642': 'inv_scroll_03',    // Recipe: Free Action Potion
                    '12210': 'inv_misc_food_73_roastraptor', // Roast Raptor
                    '21217': 'inv_misc_fish_13', // Sagefish Delight
                    '6657': 'inv_misc_fish_19', // Savory Deviate Delight
                    '10306': 'inv_scroll_07',   // Scroll of Spirit IV
                    '3928': 'inv_potion_54',    // Superior Healing Potion
                    '2459': 'inv_potion_08',    // Swiftness Potion
                    '12820': 'inv_potion_92',   // Winterfall Firewater
                };
                
                // Check if we have a mapping for this item
                if (classicIconMap[itemId]) {
                    const size = element.classList.contains('basket-icon') ? 'small' : 'large';
                    element.src = `https://wow.zamimg.com/images/wow/icons/${size}/${classicIconMap[itemId]}.jpg`;
                }
            });
        }
    </script>

    <!-- Simple Wowhead tooltip configuration -->
    <script>
        const whTooltips = {
            colorLinks: true,
            iconizeLinks: true,  // Let Wowhead handle the icons
            renameLinks: false,
            iconSize: 'medium',
            domain: 'classic'
        };
    </script>
    <script src="https://wow.zamimg.com/widgets/power.js"></script>

    <!-- Remove the custom icon handling scripts and simplify the item creation -->
    <script>
        // Modify the displayItems function to use Wowhead's built-in icon functionality
        function displayItems(category, sortBy = 'rarity-desc') {
            // Clear the item list
            itemList.innerHTML = '';
            
            // Show all items or filter by category
            let items = [];
            if (category === 'all') {
                shopInventory.categories.forEach(cat => {
                    items = items.concat(cat.items.map(item => ({...item, category: cat.id})));
                });
            } else {
                const categoryData = shopInventory.categories.find(cat => cat.id === category);
                if (categoryData) {
                    items = categoryData.items.map(item => ({...item, category: category}));
                }
            }
            
            // Sort items based on sortBy parameter
            items = sortItems(items, sortBy);
            
            // Create item cards
            items.forEach(item => {
                const itemCard = document.createElement('div');
                itemCard.className = `item-card ${item.quality}`;
                itemCard.innerHTML = `
                    <div class="item-header">
                        <div class="item-name">
                            <a href="https://www.wowhead.com/classic/item=${item.id}" 
                               data-wowhead="item=${item.id}&domain=classic" 
                               class="wowhead-link" 
                               target="_blank">${item.name}</a>
                        </div>
                    </div>
                    <div class="item-details">
                        <div class="item-price">
                            ${createPriceHTML(item)}
                        </div>
                        <div class="item-stock">In stock: ${item.stock}</div>
                        ${item.unique ? '<div style="color: #ff8c00; font-size: 0.8rem;">Unique Item</div>' : ''}
                    </div>
                    <div class="item-actions">
                        <div class="quantity-controls">
                            <button class="quantity-btn qty-minus" data-id="${item.id}">-</button>
                            <input type="number" class="quantity-input" min="1" max="${item.stock}" value="1" data-id="${item.id}">
                            <button class="quantity-btn qty-plus" data-id="${item.id}">+</button>
                        </div>
                        <button class="add-to-cart" data-id="${item.id}" data-category="${item.category}">
                            Add to Cart
                        </button>
                    </div>
                `;
                itemList.appendChild(itemCard);
                
                // Add event listeners for quantity buttons
                const minusBtn = itemCard.querySelector('.qty-minus');
                const plusBtn = itemCard.querySelector('.qty-plus');
                const qtyInput = itemCard.querySelector('.quantity-input');
                
                minusBtn.addEventListener('click', function() {
                    if (parseInt(qtyInput.value) > 1) {
                        qtyInput.value = parseInt(qtyInput.value) - 1;
                    }
                });
                
                plusBtn.addEventListener('click', function() {
                    if (parseInt(qtyInput.value) < parseInt(qtyInput.max)) {
                        qtyInput.value = parseInt(qtyInput.value) + 1;
                    }
                });
                
                // Add event listener for add to cart button
                const addToCartBtn = itemCard.querySelector('.add-to-cart');
                addToCartBtn.addEventListener('click', function() {
                    const itemId = this.dataset.id;
                    const itemCategory = this.dataset.category;
                    const quantity = parseInt(qtyInput.value);
                    
                    // Find item in inventory
                    const category = shopInventory.categories.find(cat => cat.id === itemCategory);
                    const item = category.items.find(i => i.id === itemId);
                    
                    // Check if already in cart
                    const existingItem = cart.find(cartItem => cartItem.id === itemId);
                    
                    if (existingItem) {
                        // Check if adding would exceed stock
                        if (existingItem.quantity + quantity <= item.stock) {
                            existingItem.quantity += quantity;
                        } else {
                            existingItem.quantity = item.stock; // Set to max available
                            alert(`You can only add ${item.stock} of this item to your cart.`);
                        }
                    } else {
                        // Add new item to cart
                        cart.push({
                            id: item.id,
                            name: item.name,
                            price: {...item.price},
                            quantity: quantity,
                            category: itemCategory,
                            quality: item.quality,
                            stock: item.stock
                        });
                    }
                    
                    // Update the cart display
                    updateCartDisplay();
                });
            });
            
            // Refresh Wowhead tooltips
            if (window.$WowheadPower) {
                window.$WowheadPower.refreshLinks();
            }
        }
        
        // Update the cart display function to use Wowhead's built-in icon functionality
        function updateCartDisplay() {
            // Clear current display
            basketItems.innerHTML = '';
            
            if (cart.length === 0) {
                basketItems.innerHTML = '<div class="empty-basket-message">Your basket is empty</div>';
                basketCount.textContent = '0';
                basketItemsCount.textContent = '0';
                basketGold.textContent = '0';
                basketSilver.textContent = '0';
                return;
            }
            
            // Count total items and cost
            let totalItems = 0;
            let totalGold = 0;
            let totalSilver = 0;
            
            cart.forEach(item => {
                // Create cart item element
                const cartItemEl = document.createElement('div');
                cartItemEl.className = 'basket-item';
                
                // Calculate item total
                const itemTotalSilver = item.price.total * item.quantity;
                const itemGold = Math.floor(itemTotalSilver / 100);
                const itemSilver = itemTotalSilver % 100;
                
                cartItemEl.innerHTML = `
                    <div class="basket-item-info">
                        <div class="basket-item-details">
                            <div class="basket-item-name ${item.quality}">
                                <a href="https://www.wowhead.com/classic/item=${item.id}" 
                                   data-wowhead="item=${item.id}&domain=classic" 
                                   class="wowhead-link" 
                                   target="_blank">${item.name}</a>
                            </div>
                            <div class="basket-item-actions">
                                <div class="basket-quantity-controls">
                                    <button class="basket-quantity-btn basket-qty-minus" data-id="${item.id}">-</button>
                                    <input type="number" class="basket-quantity-input" min="1" max="${item.stock}" value="${item.quantity}" data-id="${item.id}">
                                    <button class="basket-quantity-btn basket-qty-plus" data-id="${item.id}">+</button>
                                </div>
                                <div class="basket-item-total" title="Price per item: ${item.price.gold}g ${item.price.silver}s">
                                    <span>${itemGold}</span>
                                    <span class="gold-icon"></span>
                                    <span>${itemSilver}</span>
                                    <span class="silver-icon"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="basket-item-remove" data-id="${item.id}" title="Remove item">×</button>
                `;
                
                basketItems.appendChild(cartItemEl);
                
                // Add event listeners for cart quantity
                const minusBtn = cartItemEl.querySelector('.basket-qty-minus');
                const plusBtn = cartItemEl.querySelector('.basket-qty-plus');
                const qtyInput = cartItemEl.querySelector('.basket-quantity-input');
                const removeBtn = cartItemEl.querySelector('.basket-item-remove');
                
                minusBtn.addEventListener('click', function() {
                    const itemId = this.dataset.id;
                    const cartItem = cart.find(item => item.id === itemId);
                    
                    if (cartItem.quantity > 1) {
                        cartItem.quantity--;
                        updateCartDisplay();
                    }
                });
                
                plusBtn.addEventListener('click', function() {
                    const itemId = this.dataset.id;
                    const cartItem = cart.find(item => item.id === itemId);
                    
                    if (cartItem.quantity < cartItem.stock) {
                        cartItem.quantity++;
                        updateCartDisplay();
                    }
                });
                
                qtyInput.addEventListener('change', function() {
                    const itemId = this.dataset.id;
                    const cartItem = cart.find(item => item.id === itemId);
                    const newQty = parseInt(this.value);
                    
                    if (newQty > 0 && newQty <= cartItem.stock) {
                        cartItem.quantity = newQty;
                    } else if (newQty > cartItem.stock) {
                        cartItem.quantity = cartItem.stock;
                    } else {
                        cartItem.quantity = 1;
                    }
                    
                    updateCartDisplay();
                });
                
                removeBtn.addEventListener('click', function() {
                    const itemId = this.dataset.id;
                    cart = cart.filter(item => item.id !== itemId);
                    updateCartDisplay();
                });
                
                // Update totals
                totalItems += item.quantity;
                totalSilver += itemTotalSilver;
            });
            
            // Update basket counts and totals
            totalGold = Math.floor(totalSilver / 100);
            totalSilver = totalSilver % 100;
            
            basketCount.textContent = totalItems;
            basketItemsCount.textContent = totalItems;
            basketGold.textContent = totalGold;
            basketSilver.textContent = totalSilver;
            
            // Refresh Wowhead tooltips
            if (window.$WowheadPower) {
                window.$WowheadPower.refreshLinks();
            }
        }
    </script>

    <!-- Add a function to sort items -->
    <script>
        function sortItems(items, sortBy) {
            const rarityOrder = {
                'common': 1,
                'uncommon': 2,
                'rare': 3,
                'epic': 4,
                'legendary': 5
            };
            
            switch(sortBy) {
                case 'rarity-desc':
                    return items.sort((a, b) => rarityOrder[b.quality] - rarityOrder[a.quality]);
                case 'rarity-asc':
                    return items.sort((a, b) => rarityOrder[a.quality] - rarityOrder[b.quality]);
                case 'price-desc':
                    return items.sort((a, b) => {
                        const aTotal = a.price.total;
                        const bTotal = b.price.total;
                        return bTotal - aTotal;
                    });
                case 'price-asc':
                    return items.sort((a, b) => {
                        const aTotal = a.price.total;
                        const bTotal = b.price.total;
                        return aTotal - bTotal;
                    });
                case 'name-asc':
                    return items.sort((a, b) => a.name.localeCompare(b.name));
                case 'name-desc':
                    return items.sort((a, b) => b.name.localeCompare(a.name));
                default:
                    return items;
            }
        }
    </script>

    <!-- Update the checkout function to separate instructions from copy-paste content -->
    <script>
        function checkout() {
            if (cart.length === 0) {
                alert('Your basket is empty!');
                return;
            }
            
            // Create modal for checkout
            const modal = document.createElement('div');
            modal.className = 'modal';
            
            // Get current date + 1 day for "delivery date"
            const today = new Date();
            const deliveryDate = new Date(today);
            deliveryDate.setDate(today.getDate() + 1);
            const formattedDate = `${deliveryDate.getMonth() + 1}/${deliveryDate.getDate()}/${deliveryDate.getFullYear()}`;
            
            // Calculate total
            let totalSilver = 0;
            cart.forEach(item => {
                totalSilver += item.price.total * item.quantity;
            });
            const totalGold = Math.floor(totalSilver / 100);
            const remainingSilver = totalSilver % 100;
            
            // Create order text (this is what will be copied)
            let orderText = '';
            
            // Add items with quantities and prices
            cart.forEach(item => {
                const itemTotalSilver = item.price.total * item.quantity;
                const itemGold = Math.floor(itemTotalSilver / 100);
                const itemSilver = itemTotalSilver % 100;
                
                orderText += `${item.name} x${item.quantity} (${item.price.gold}g ${item.price.silver}s each) = ${itemGold}g ${itemSilver}s\n`;
            });
            
            // Add total
            orderText += `\nTOTAL: ${totalGold} gold and ${remainingSilver} silver`;
            
            // Create modal content
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <h2>Your Order</h2>
                    
                    <div class="checkout-info">
                        <p>Copy and paste the following text into an in-game mail to place your order:</p>
                    </div>
                    
                    <div class="checkout-copy-area">
                        <textarea id="orderDetails" readonly>${orderText}</textarea>
                        <button id="copyOrder" class="copy-button">COPY TO CLIPBOARD</button>
                    </div>
                    
                    <div class="checkout-instructions">
                        <p><strong>ORDER - ${formattedDate}</strong></p>
                        <p><strong>TO:</strong> Nymnsen</p>
                        <p>The items will be sent to you via C.O.D. (Cash on Delivery).</p>
                    </div>
                    
                    <div class="checkout-actions">
                        <button id="confirmOrder" class="confirm-button">Confirm Order</button>
                        <button id="cancelOrder" class="cancel-button">Cancel</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            const closeBtn = modal.querySelector('.close-modal');
            const copyBtn = modal.querySelector('#copyOrder');
            const confirmBtn = modal.querySelector('#confirmOrder');
            const cancelBtn = modal.querySelector('#cancelOrder');
            const textarea = modal.querySelector('#orderDetails');
            
            closeBtn.addEventListener('click', function() {
                document.body.removeChild(modal);
            });
            
            copyBtn.addEventListener('click', function() {
                textarea.select();
                document.execCommand('copy');
                this.textContent = 'COPIED!';
                setTimeout(() => {
                    this.textContent = 'COPY TO CLIPBOARD';
                }, 2000);
            });
            
            confirmBtn.addEventListener('click', function() {
                // Clear cart and close modal
                cart = [];
                updateCartDisplay();
                document.body.removeChild(modal);
                
                // Show confirmation message
                const confirmMessage = document.createElement('div');
                confirmMessage.className = 'confirm-message';
                confirmMessage.textContent = 'Order placed successfully!';
                document.body.appendChild(confirmMessage);
                
                setTimeout(() => {
                    document.body.removeChild(confirmMessage);
                }, 3000);
            });
            
            cancelBtn.addEventListener('click', function() {
                document.body.removeChild(modal);
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }
    </script>

    <!-- Add a function to create price HTML -->
    <script>
        function createPriceHTML(item) {
            let priceHTML = '';
            
            // Handle different price formats
            if (item.price) {
                if (typeof item.price === 'object' && item.price !== null) {
                    // New format
                    const gold = item.price.gold || 0;
                    const silver = item.price.silver || 0;
                    priceHTML = `${gold}<span class="gold-icon"></span>${silver}<span class="silver-icon"></span>`;
                } else {
                    // Old format (single number)
                    const gold = Math.floor(item.price / 100);
                    const silver = item.price % 100;
                    priceHTML = `${gold}<span class="gold-icon"></span>${silver}<span class="silver-icon"></span>`;
                }
            } else {
                // Fallback if price is missing
                priceHTML = `0<span class="gold-icon"></span>0<span class="silver-icon"></span>`;
            }
            
            return priceHTML;
        }
    </script>
</body>
</html>